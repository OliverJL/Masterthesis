\chapter{Operating System Virtualization with the Xen-Hypervisor}
\label{cha:2}

\section{General}\label{sec:xen-generall}

Virtualization of operating systems has increased continuously over the recent years and layed the foundations for new resource management concepts and business models like f.e. cloud hosting. Regarding server virtualization, many organizations exceed rates of 75\% \cite{gartnervmmarket}. By executing an operating system as a virtual machine (VM), improvements in several areas can be achieved. As instances of even different operating systems can be run parallel on the same host machine, system capacity, in terms of processing power, volatile and persistent memory can be utilized more efficient. A VM can even be assigned resources dynamically at runtime, without the need of a restart. Further, backup \& recovery strategies can be simplified, as a VM's physical presentation at any certain state can be preserved in files. This even enables to move a running VM from one to another server in the same resource pool with virtually no service interruption \cite{migratevms}. Also the process of providing a new VM instance can be slimmed down drastically. Instead of being required to execute an operating system setup for a particular hardware composition, a once created VM master image can be cloned and configured. Depending on the applied technology, VMs can be setup up on basis of operating system setup images which are targeted for installation directly on hardware, without any further modification required. In other words, the so called virtual machine monitor or hypervisor enables the execution of regular proprietary or open source operating systems in a virtual environment. \\
According to a study of Gartner from 2016, the market for x86 server virtualization infrastructure software is partitioned among few competitors, led by VMWare, Microsoft, Oracle and Red Hat. While VMWare and Microsoft offer proprietary solutions, Oracle and Red Hat adopted the open-source Xen-hypervisor technology. For cloud infrastructures, the Xen-Hypervisor remains the most widely used architecture for public infrastructure as a service (IaaS) cloud provider. This fact is predominantly attributable to Amazon's utilization of the Xen-Hypervisor for its cloud solutions "Amazon Web Services" \cite{bittman2016magic}.
\\~\\
Xen or also Xen-Project is an open source project developed and maintained by the Linux Foundation
. It originally was started at the University of Cambridge in 2003 and is supported by several 
big players in the IT-industry like Citrix$^\text{\textregistered}$ or Intel$^\text{\textregistered}$ \cite{xenprjct}; One of the core requirement of operating system virtualization is the management and scheduling of available hardware for virtual machines. This is accomplished by an abstraction layer located between the a virtual machine and the hardware itself. There are two types of common virtualization architectures:

\begin{itemize}
	\item \textbf{Type I Hypervisor} The hypervisor is running directly on the provided hardware, hence also called Bare Metal Hypervisor/Virtualization. Xen is a Type I Hypervisor. 
	\item \textbf{Type II Hypervisor} The abstraction layer of a is realized further up, between a virtual machine and a hosting operating system, directly installed on hardware, like VMWare, f.e. 
\end{itemize}

In the following an introduction to the architecture of an Xen based virtual environment will be given with a focus on components and configurations relevant for this thesis. 


\section{Xen Architecture}




\ref{sec:xen-generall}



Historie

xenprjct

- Open Source
- Amazon
- Verbreitung 
- HVM / PVM
- Architektur

------------------------------------
\cite{everspaugh2014not}
Second,aVM  can be repeatedly executed froma ?xed image which is the default for amazon
Dort auch: infos zu regualr boot/snapshot/masterimage
------------------------------------

Xen Domu KOnfiguration erwahnen, zB. Anzahl an CPUS

However, while there are many reasons to utilize virtual machines, most of the standard security practices of operating systems are based on assumptions that hold true for physical machines, but don't translate immediately into the domain of virtualized machines \cite{kerrigan2012study}. A virtual hosted Linux server f.e. will never receive a user triggered event during the boot process, which is a critical period within the initialization of the internal Linux PRNG. Further, new virtual machine instances are usually provided by cloning a master image, instead of running an installation setup, leading to a higher degree of homogeneity among virtual machine instances. While provisioning time and maintenance benefit from this practice, it may be regarded critical. If this approach f.e. is applied as the standard process of a cloud hosting provider, it`s customers may be delivered a vulnerable system from the outset, since one customer might gain insights regarding another customers system, just by analyzing his own. These insights can be used to exploit VM reset vulnerabilities which take advantage of the reuse of  operating system snapshots, so called snapshot replay. Thomas Ristenpart et. al. describe this type of attack and apply it on TSL implementations with disastrous results. Relevant reasons they identified are the exposure of randomness, as well as the inability to find sufficient entropy in virtual systems environments \cite{ristenpart2010good, ristenpart2009hey}. \\~\\
According to a study of Gartner from 2016, the market for x86 server virtualization infrastructure software is partitioned among few competitors, led by VMWare, Microsoft, Oracle and Red Hat. While VMWare and Microsoft offer proprietary solutions, Oracle and Red Hat adopted the open-source Xen-hypervisor technology. For cloud infrastructures, the Xen-hypervisor remains the most widely used architecture for public infrastructure as a service (IaaS) cloud provider. This fact is predominantly attributable to Amazon's utilization of the Xen-hypervisor for its cloud solutions "Amazon Web Services" \cite{bittman2016magic}. 

Similarly, the market of common server operating systems can be divided into proprietary and open-source solutions. While Microsoft dominates the fraction of proprietary systems with its Windows Server series, Linux based systems have a total share of \~37\%. Within this share, \~39\% of servers dedicated to host websites etc. are running an Ubuntu Distribution \cite{statsharelinux} . \\~\\

\begin{figure}[H]
	\centering
	\input{xen-arch.tex}
	\caption{Xen Architecture} \label{fig:xen-arch}
\end{figure}


%The non-default choices for tsc_mode are:
%- tsc_mode=1 (always emulate). All rdtsc instructions are emulated;
%this is the best choice when TSC-sensitive apps are running and
%it is necessary to understand worst-case performance degradation
%for a specific hardware environment.
%- tsc_mode=2 (never emulate).  This is the same as prior to Xen 4.0
%and is the best choice if it is certain that all apps running in
%this VM are TSC-resilient and highest performance is required.
%- tsc_mode=3 (PVRDTSCP).  High-TSC-frequency apps may be paravirtualized
%(modified) to obtain both correctness and highest performance; any
%unmodified apps must be TSC-resilient.



The x86 "timestamp counter", or TSC, is a 64-bit register on each
processor that increases monotonically.  Historically, TSC incremented
every processor cycle, but on recent processors, it increases
at a constant rate even if the processor changes frequency (for example,
to reduce processor power usage).  TSC is known by x86 programmers
as the fastest, highest-precision measurement of the passage of time
so it is often used as a foundation for performance monitoring.
And since it is guaranteed to be monotonically increasing and, at
64 bits, is guaranteed to not wraparound within 10 years, it is
sometimes used as a random number or a unique sequence identifier,
such as to stamp transactions so they can be replayed in a specific
order
\cite{xentscmode}

